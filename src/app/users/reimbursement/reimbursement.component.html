<div class="wrapper">
  <div class="content-wrapper">
    <section class="content-header">
      <h4>Reimbursement</h4>
      <div>
        <button type="submit"
          class="btn bg-orange btn-flat btn-request" (click)="recordResponse(responseTemplate,false)"><i class="fa fa-submit" aria-hidden="true"></i>New Claim</button>
      </div>
      <div class="container">
        <div class="row">
          <form (ngSubmit)="getData()" [formGroup]="reimbursementform">
          <div class="col-md-1">
            <label class="filter-label">Add Filter</label>
          </div>
          <div class="col-md-3">
            <select class="form-control" name="month" formControlName="month" required="true">
              <option value="{{cmonth}}" [selected]="true">{{currentmonth}}</option>
              <option *ngFor="let m of months" value="{{m.month_id}}">{{m.month_name}}</option>
            </select>
          </div>
          <div class="col-md-3">
            <select class="form-control" name="year" formControlName="year" required="true">
              <option enabled>{{currentyear}}</option>
              <option *ngFor="let y of years" value="{{y}}">{{y}}</option>
            </select>
          </div>
          <button type="submit" class="btn bg-orange btn-flat btn-apply">Apply</button>
          </form>
        </div>
      </div>
    </section>
    <section class="content helpdesk_wrapper">
      <div class="row">
        <div class="box-body">
          <div class="table-responsive">
            <div class="row">
              <div class="col-md-12">
                <ul class="nav nav-tabs">
                  <li [ngClass]="{ 'active': openunapproved==true }">
                    <a id="labelColor" role="button" (click)="getUnapprovedData()">Unapproved</a>
                  </li>
                  <li [ngClass]="{ 'active': openapproved==true }">
                    <a id="labelColor" role="button" (click)="getApprovedData()">Approved</a>
                  </li>
                  <li [ngClass]="{ 'active': openrejected==true }">
                    <a id="labelColor" role="button" (click)="getRejectedData()">Rejected</a>
                  </li>
                </ul>
              </div>
            </div>
            <table id="RembursementDataTables" class="table table-bordered table-striped table-hover" datatable [dtOptions]="rembursementTableOptions" [dtTrigger]="reimbursementTableTrigger">
            <thead>
              <tr>
                <th>Sr.No</th>
                <th>Date</th>
                <th>Category</th>
                <th>Purpose</th>
                <th>Manager Comment</th>
                <th>Amount</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let l of rembursement_api_data">
                <td>{{l.id}}</td>
                <td>{{l.display_date}}</td>
                <td>{{l.category_name}}</td>
                <td>{{l.purpose}}</td>
                <td></td>
                <td>{{l.amount}}</td>
                <td>
                  <a style="cursor: pointer;font-size:24px"><i class="fa fa-eye field-icon toggle-password" aria-hidden="true" (click)="viewreimbursementsingledata(viewrembursementsingledatamodal,l)"></i></a>&nbsp;
                  <!-- <a style="cursor: pointer;" *ngIf="openunapproved || openrejected"><i class="fa fa-pencil" aria-hidden="true" (click)="editreimbursementclaim(editreimbursementclaimmodal,l)"></i></a>&nbsp; -->
                  <a  data-confirm="Are you sure to delete this item?" *ngIf="openunapproved"><i class="fa fa-trash" (click)="deletereimbursementsingledata(l)"></i></a>
                </td>
              </tr>
            </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
<ng-template #responseTemplate>
  <div class="modal-header ticket-popup-header">
    <h4 class=" modal-title pull-left">New Reimbursement Claim</h4>
    <button type="button" style="color: white;" class="close pull-right" aria-label="Close" (click)="closeModal()">
    <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body ticket-popup">
    <form [formGroup]="form" (ngSubmit)="submit(model)">
    <div class="form-group col-md-12">
      <label>Category<sup style="color:red;">*</sup></label>
      <select name="category" (change)="enableFormAccordingToCategory($event)"
      class="select2 form-control" style="width: 100%; height: 35px;" [class.error1]="!form.controls.category.valid && form.controls.category.dirty"
      required>
      <option value="" disabled="disabled">Select item</option>
      <option *ngFor="let s of categoriesArray" value="{{s.id}}">{{s.value}}</option>
      </select>
      <div
        *ngIf="(form.get( 'category').hasError( 'required') ) && form.get( 'category').touched">
        <div class="error"
          *ngIf="form.get( 'category').hasError( 'category') && form.get( 'category').touched">
          This field is mandatory
        </div>
      </div>
    </div>
    <formly-form [model]="model" [fields]="fields" [options]="options">
    <div class='clearfix'></div>
    <div class="md-footer-btm">
    <div class=''>
      <button type="submit" class="btn btn-default btn-orange">Submit</button>
    </div>
  </div>
    <div class='clearfix'></div>
    </formly-form>
    </form>
  </div>
</ng-template>
<ng-template #viewrembursementsingledatamodal>
  <div class="modal-content" >
    <form>
      <div class="modal-header ticket-popup-header">
        <h4 class="modal-title pull-left">Reimbursement Claim</h4>
        <a><span class="fa fa-times pull-right" style="color: white;cursor:pointer;" (click)="closerembursementsingledatamodal()"></span></a>
      </div>
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group col-md-4">
            <label>Month</label><br>
            <span>{{splitmonthyear[0]}}</span>
          </div>
          <div class="form-group col-md-4">
            <label>Year</label><br>
            <span>{{splitmonthyear[1]}}</span>
          </div>
          <div class="form-group col-md-4">
            <label>Category</label><br>
            <span>{{single_user_data.category_name}}</span>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-4">
            <label>Amount</label><br>
            <span>{{single_user_data.amount}}</span>
          </div>
          <div class="form-group col-md-4">
            <label>Date</label><br>
            <span>{{single_user_data.display_date}}</span>
          </div>
          <div class="form-group col-md-4">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-12">
            <label>Purpose</label><br>
            <span>{{single_user_data.purpose}}</span>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-12">
            <label>Attached Bill</label>&nbsp;
            <a href="{{single_user_data.receipt}}" target='_blank' class="btn btn-primary">View File</a>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12" style="text-align: center;">
            <button type="button" class="btn btn-warning" (click)="closerembursementsingledatamodal()">Close</button>
          </div>
        </div>
      </div>
    </form>
  </div>
</ng-template>
